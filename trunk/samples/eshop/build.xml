<?xml version="1.0"?>
<project name="eshop" default="compile">

		<path id="classpath">
    	<fileset dir="lib">
        <include name="**/*.jar"/>
      </fileset>
    </path>
    
    <path id="test-classpath">
    	<pathelement location="classes"/>
    	<fileset dir="lib">
        <include name="**/*.jar"/>
      </fileset>
    </path>
    
    <path id="all-classpath">
    	<pathelement location="classes"/>
    	<pathelement location="test-classes"/>
    	<fileset dir="lib">
        <include name="**/*.jar"/>
      </fileset>
    </path>

    <target name="clean" description="remove intermediate files">
        <delete dir="classes"/>
    </target>
    
    <target name="compile" description="compile the Java source code to class files" depends="clean">
        <mkdir dir="classes"/>
        <javac destdir="classes" classpathref="classpath">
        	<src path="src/main/java"/>
        	<src path="src/main/resources"/>
        </javac>
        <copy todir="classes">
        	<fileset dir="src/main/java">
        		<exclude name="**/*.java"/>
        	</fileset>
        	<fileset dir="src/main/resources"/>
        </copy>
    </target>
    
    <target name="compile-tests" description="compile the Java source code to class files" depends="compile">
        <mkdir dir="test-classes"/>
        <javac destdir="test-classes" classpathref="test-classpath">
        	<src path="src/test/java"/>
        	<src path="src/test/resources"/>
        </javac>
        <copy todir="test-classes">
        	<fileset dir="src/test/java">
        		<exclude name="**/*.java"/>
        	</fileset>
        	<fileset dir="src/test/resources"/>
        </copy>
    </target>
    
    <target name="run-tests" description="Run all unit tests" depends="compile-tests">
    		<mkdir dir="testresults"/>
    		<junit haltonfailure="no" printsummary="yes">
    				<classpath refid="all-classpath"/>
    				<formatter type="xml"/>
    				<batchtest fork="yes" todir="testresults">
    						<fileset dir="src/test/java">
    								<include name="**/*Test.java"/>
    								<exclude name="**/Base*Test.java"/>
    						</fileset>
    				</batchtest>
    		</junit>
    </target>
    
</project>